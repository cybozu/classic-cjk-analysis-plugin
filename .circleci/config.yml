version: 2
references:
  variables:
    maven-cache-path: &maven-cache-path
      - ~/.m2
jobs:
  test:
    docker:
      - image: docker-registry.dev.cybozu.xyz/classic-cjk-tokenizer/circleci-build-base
    steps:
      - checkout
      - run: ./gradlew spotlessCheck test
  renovate:
    docker:
      - image: renovate/renovate:17.16.5
        environment:
          RENOVATE_ENDPOINT: https://github.dev.cybozu.co.jp/api/v3
          # Debugg Options:
          # RENOVATE_DRY_RUN: true
          # RENOVATE_FORCE_CLI: true
          RENOVATE_REPOSITORIES: CYDEC/classic-cjk-analysis-plugin
          RENOVATE_GIT_FS: https
          # TOKEN is defined in circleci management console.
          # The token is generated by yokotaso.
          # RENOVATE_TOKEN: *****

    steps:
      - checkout
      - run: node "/usr/src/app/dist/renovate.js" "--labels=renovate"

workflows:
  version: 2
  build_and_test:
    jobs:
      - test
  schedule-workflow:
    triggers:
      - schedule:
          cron: "0 * * * *"
          filters:
            branches:
              only:
                - master
    jobs:
      - renovate 
